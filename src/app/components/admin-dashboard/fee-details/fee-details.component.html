<ng-container *ngIf="!studentId">
    <h4 class="mt-3" (click)="expandSection()">
        <i class="fa-solid fa-circle-plus expand-link" *ngIf="!isExpanded"></i>
        <i class="fa-solid fa-circle-minus expand-link" *ngIf="isExpanded"></i>
        Add Fees
    </h4>
    <div class="box-container" *ngIf="isExpanded">
        <form [formGroup]="feeForm">
            <div class="row">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-2">
                    <app-student-select></app-student-select>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-2">
                    <label>Month</label>
                    <ng-select placeholder="Select month" formControlName="month" bindLabel="name" bindValue="value"
                    [ngClass]="{ 'invalid-field': isFieldInvalid('month') }"
                        [items]="monthsList">
                    </ng-select>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-2">
                    <label>Date</label>
                    <app-date-picker></app-date-picker>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Registration</label>
                    <input type="number" class="form-control" formControlName="registration" placeholder="Registration fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Monthly</label>
                    <input type="number" class="form-control" formControlName="monthly" placeholder="Monthly fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Van</label>
                    <input type="number" class="form-control" formControlName="van" placeholder="Van charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Course</label>
                    <input type="number" class="form-control" formControlName="course" placeholder="Course charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Copies (x20)</label>
                    <input type="number" class="form-control" formControlName="copies" placeholder="Copies charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Diary</label>
                    <input type="number" class="form-control" formControlName="diary" placeholder="Diary charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Shoes</label>
                    <input type="number" class="form-control" formControlName="shoes" placeholder="Shoes charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Socks</label>
                    <input type="number" class="form-control" formControlName="socks" placeholder="Socks charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Tie & Belt</label>
                    <input type="number" class="form-control" formControlName="tieBelt" placeholder="Tie & Belt charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Other</label>
                    <input type="number" class="form-control" formControlName="other" placeholder="Other charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Total</label>
                    <input type="number" class="form-control" formControlName="total" [ngClass]="{ 'invalid-field': isFieldInvalid('total') }" placeholder="Total fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Deposited</label>
                    <input type="number" class="form-control" formControlName="deposited"  [ngClass]="{ 'invalid-field': isFieldInvalid('deposited') }" placeholder="Deposited fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Remaining</label>
                    <input type="number" class="form-control" formControlName="remaining" placeholder="Remaining fee"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="d-flex justify-content-center detail-btn">
                    <button class="btn btn-success m-right-5" (click)="onSave()">Save</button>
                    <button class="btn btn-danger m-left-5" (click)="onReset()">Reset</button>
                </div>
            </div>
        </form>
    </div>
</ng-container>

<ng-container *ngIf="studentId">
    <div class="col-xl-2 col-lg-2 col-md-3 col-sm-4 col-xs-4 col-4 pt-3">
        <button class="btn btn-primary app-btn app-primary" title="Go back" (click)="goBack()"><i
                class="fa-solid fa-backward"></i></button>
    </div>
</ng-container>
<h4 class="mt-5">
    <i class="fa-solid fa-circle-right"></i>
    Fee Details
    <button class="btn btn-danger app-btn app-danger download-btn" title="Download" (click)="download()"><i class="fa-solid fa-file-arrow-down"></i></button>
</h4>
<div class="row mt-1" *ngIf="!studentId">
    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-6 col-6 pt-1">
        <ng-select
            [items]="studentsList"
            bindLabel="firstName"
            placeholder="Search by student"
            [(ngModel)]="nameSearch"
            (change)="searchBy({ value: $event?.id }, 'student')"
        >
            <ng-template ng-option-tmp let-item="item">
                {{ item.firstName + ' ' + item.lastName + ' (' + item.uDiasCode + ')' }}
            </ng-template>
        </ng-select>
    </div>
    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-6 col-6 pt-1">
        <ng-select
            [items]="monthsList"
            bindLabel="name"
            placeholder="Search by month"
            [(ngModel)]="monthSearch"
            (change)="searchBy({ value: $event?.name }, 'month')"
        ></ng-select>
    </div>
    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-6 col-6 pt-1">
        <ng-select
            [items]="standardsList"
            bindLabel="name"
            bindValue="id"
            placeholder="Search by class"
            [(ngModel)]="standardSearch"
            (change)="searchBy({ value: $event?.id }, 'class')"
        ></ng-select>
    </div>
</div>
<div *ngIf="!studentId" class="mt-2 filtered-total">
    <div>{{ filteredTotal }}</div>
</div>
<div class="box-container">
    <div class="app-table-container" *ngIf="isDataFiltered; else showLoader">
        <table class="app-table" #download>
            <thead>
                <tr>
                    <th>S. No</th>
                    <th *ngIf="!studentId">Student</th>
                    <th>Month</th>
                    <th>Total Fee</th>
                    <th>Deposited</th>
                    <th>Remaining</th>
                    <th>Class</th>
                    <th>Date</th>
                    <th *ngIf="!studentId">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let fee of filteredFeesList; let i = index">
                    <td>{{i+1}}</td>
                    <td *ngIf="!studentId">{{ getStudent(fee.studentId) }}</td>
                    <td>{{ fee?.month | titlecase }}</td>
                    <td>{{ fee?.total }}</td>
                    <td>{{ fee?.deposited }}</td>
                    <td>{{ fee.total - fee.deposited }}</td>
                    <td>{{ getClass(fee.standardId) }}</td>
                    <td>{{ fee?.date | slice:0:10 }}</td>
                    <td *ngIf="!studentId">
                        <app-action-select [showDelete]="true" [showEdit]="true"
                            (action)="onAction($event, fee)"></app-action-select>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<ng-template #showLoader>
    <app-loader-line></app-loader-line>
</ng-template>