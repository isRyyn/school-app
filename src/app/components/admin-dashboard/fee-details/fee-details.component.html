<ng-container *ngIf="!studentId">
    <h4 class="mt-3" (click)="expandSection()">
        <i class="fa-solid fa-circle-plus expand-link" *ngIf="!isExpanded"></i>
        <i class="fa-solid fa-circle-minus expand-link" *ngIf="isExpanded"></i>
        Add Fees
    </h4>
    <div class="box-container" *ngIf="isExpanded">
        <form [formGroup]="feeForm">
            <div class="row">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-2">
                    <app-student-select></app-student-select>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-2">
                    <label>Month</label>
                    <ng-select placeholder="Select month" formControlName="month" bindLabel="name" bindValue="value"
                    [ngClass]="{ 'invalid-field': isFieldInvalid('month') }"
                        [items]="monthsList">
                    </ng-select>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-2">
                    <label>Date</label>
                    <app-date-picker></app-date-picker>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Registration</label>
                    <input type="number" class="form-control" formControlName="registration" placeholder="Registration fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Monthly</label>
                    <input type="number" class="form-control" formControlName="monthly" placeholder="Monthly fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Van</label>
                    <input type="number" class="form-control" formControlName="van" placeholder="Van charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Course</label>
                    <input type="number" class="form-control" formControlName="course" placeholder="Course charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Copies (x20)</label>
                    <input type="number" class="form-control" formControlName="copies" placeholder="Copies charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Diary</label>
                    <input type="number" class="form-control" formControlName="diary" placeholder="Diary charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Shoes</label>
                    <input type="number" class="form-control" formControlName="shoes" placeholder="Shoes charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Socks</label>
                    <input type="number" class="form-control" formControlName="socks" placeholder="Socks charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Tie & Belt</label>
                    <input type="number" class="form-control" formControlName="tieBelt" placeholder="Tie & Belt charges"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Other 1</label>
                    <input type="number" class="form-control" formControlName="other" placeholder="Other charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Other 2</label>
                    <input type="number" class="form-control" formControlName="other2" placeholder="Other charges"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Other 3</label>
                    <input type="number" class="form-control" formControlName="other3" placeholder="Other charges"/>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Unique ID</label>
                    <input type="text" class="form-control" formControlName="uniqueId" placeholder="Unique ID"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Discount</label>
                    <input type="number" class="form-control" formControlName="discount" placeholder="Discount (if any)"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Is student Free of Cost?</label>
                    <div class="d-flex">
                        <input type="radio" formControlName="foc" [value]="true" (change)="focChanged(true)"/> 
                        <label class="radio-label">Yes</label>
                        <input type="radio" formControlName="foc" [value]="false" (change)="focChanged(false)"/>
                        <label class="radio-label">No</label>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <label>Notes/Remarks</label>
                    <textarea class="form-control" formControlName="notes" placeholder="Add notes here..."></textarea>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Total</label>
                    <input type="number" class="form-control" formControlName="total" [ngClass]="{ 'invalid-field': isFieldInvalid('total') }" placeholder="Total fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Deposited</label>
                    <input type="number" class="form-control" formControlName="deposited"  [ngClass]="{ 'invalid-field': isFieldInvalid('deposited') }" placeholder="Deposited fee"/>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 col-12 pt-3">
                    <label>Remaining</label>
                    <input type="number" class="form-control" formControlName="remaining" placeholder="Remaining fee"/>
                </div>
            </div>
            <div class="row mt-3">
                <div class="d-flex justify-content-center detail-btn">
                    <button class="btn btn-success m-right-5" (click)="onSave()">Save</button>
                    <button class="btn btn-danger m-left-5" (click)="onReset()">Reset</button>
                </div>
            </div>
        </form>
    </div>
</ng-container>

<ng-container *ngIf="studentId">
    <div class="col-xl-2 col-lg-2 col-md-3 col-sm-4 col-xs-4 col-4 pt-3">
        <button class="btn btn-primary app-btn app-primary" title="Go back" (click)="goBack()"><i
                class="fa-solid fa-backward"></i></button>
    </div>
</ng-container>
<div class="row align-items-end">
    <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 col-xs-12 col-12">
        <h4 class="mt-5">
            <i class="fa-solid fa-circle-right"></i>
            Fee Details
        </h4>      
    </div>
    <div class="col-xl-7 col-lg-7 col-md-12 col-sm-12 col-xs-12 col-12 text-end mt-3 import-btn">
        <button class="btn btn-danger app-btn app-danger download-btn" title="Download" (click)="download()"><i class="fa-solid fa-file-arrow-down"></i></button>
        <input *ngIf="importClicked" type="file" class="import-input" (change)="onImportFileChange($event)">
        <button *ngIf="!importClicked" class="btn btn-primary app-btn app-primary" (click)="importData()" [disabled]="isExpanded">Import</button>
        <button *ngIf="importClicked" class="btn btn-primary app-btn app-primary" (click)="importFile()">{{ isImporting ? 'Saving...' : 'Save' }}</button>
    </div>
</div>
<div class="row mt-1" *ngIf="!studentId">
    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-6 col-6 pt-1">
        <ng-select
            [items]="studentsList"
            bindLabel="firstName"
            placeholder="Search by student"
            [(ngModel)]="nameSearch"
            (change)="searchBy({ value: $event?.id }, 'student')"
        >
            <ng-template ng-option-tmp let-item="item">
                {{ item.firstName + ' ' + item.lastName + ' (' + item.uDiasCode + ')' }}
            </ng-template>
        </ng-select>
    </div>
    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-6 col-6 pt-1">
        <ng-select
            [items]="monthsList"
            bindLabel="name"
            placeholder="Search by month"
            [(ngModel)]="monthSearch"
            (change)="searchBy({ value: $event?.name }, 'month')"
        ></ng-select>
    </div>
    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-6 col-6 pt-1">
        <ng-select
            [items]="standardsList"
            bindLabel="name"
            bindValue="id"
            placeholder="Search by class"
            [(ngModel)]="standardSearch"
            (change)="searchBy({ value: $event?.id }, 'class')"
        ></ng-select>
    </div>
    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-6 col-6 pt-1">
        <input type="text" class="form-control unique-id-search" placeholder="Search by Unique ID" [(ngModel)]="uniqueIdSearch" (input)="searchBy({ value : uniqueIdSearch }, 'uniqueId')"/>
    </div>
</div>
<ng-container *ngIf="!studentId">
    <div class="filtered-total">
        <span *ngIf="showFilteredTotal" class="float-start">{{ filteredTotal }}</span>
        <mat-slide-toggle class="float-end" (change)="totalToggle($event)">{{ showFilteredTotal ? 'Hide Total' : 'Show Total' }}</mat-slide-toggle>
    </div>
</ng-container>

<div class="box-container">
    <div class="app-table-container" *ngIf="isDataFiltered; else showLoader">
        <table class="app-table" #download>
            <thead>
                <tr>
                    <th>S. No</th>
                    <ng-container *ngIf="!studentId">
                        <th>ID</th>
                        <th>Student</th>
                        <th>Parent's name</th>
                    </ng-container>
                    <th>Month</th>
                    <th>Total Fee</th>
                    <th>Deposited</th>
                    <th>Remaining</th>
                    <th>Class</th>
                    <th>Date</th>
                    <th *ngIf="!studentId">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let fee of filteredFeesList; let i = index">
                    <td>{{i+1}}</td>
                    <ng-container *ngIf="!studentId">
                        <td>{{ fee?.uniqueId || '' }}</td>
                        <td>{{ getStudent(fee.studentId) }}</td>
                        <td>{{ getStudentParent(fee.studentId) }}</td>
                    </ng-container>
                    <td>{{ fee?.month | titlecase }}</td>
                    <td>{{ fee?.total }}</td>
                    <td>{{ fee?.deposited }}</td>
                    <td>{{ fee.foc ? 'FOC' : fee.total - fee.deposited }}</td>
                    <td>{{ getClass(fee.standardId) }}</td>
                    <td>{{ fee?.date | slice:0:10 }}</td>
                    <td *ngIf="!studentId">
                        <app-action-select [showDelete]="true" [showEdit]="true"
                            (action)="onAction($event, fee)"></app-action-select>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<ng-template #showLoader>
    <app-loader-line></app-loader-line>
</ng-template>